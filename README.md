# 剪贴板历史工具

一个功能强大的 macOS 剪贴板历史管理工具，支持快捷键唤起、多种数据类型、搜索过滤等功能。

## 功能特性

✨ **核心功能**
- 🔥 自动监听并保存剪贴板历史（最多 200 条）
- ⌨️ 全局快捷键 `⌘⌥V` 快速唤起历史窗口
- 🖥️ 屏幕底部显示，宽度 100%，高度 20%
- ↔️ 横向滚动卡片式展示
- 🔍 实时搜索和过滤历史记录
- 📋 一键选择并自动粘贴到当前输入框

📦 **支持的数据类型**
- 📝 文本内容
- 🖼️ 图片（PNG、JPEG、TIFF 等）
- 📄 文件和文件夹
- 🔗 URL 链接

🎨 **用户界面**
- 简洁现代的 macOS 原生界面
- 状态栏图标，方便快速访问
- 屏幕底部半透明窗口设计
- 横向卡片式展示，更直观
- 支持键盘和鼠标操作

## 系统要求

- **操作系统**: macOS 11.0 (Big Sur) 或更高版本
- **架构**: Intel x86_64 或 Apple Silicon (通过 Rosetta 2)
- **权限**: 需要辅助功能权限

## 安装说明

### 方法一：使用预编译的 DMG 安装包

1. 双击打开 `剪贴板历史-1.0.0.dmg`
2. 将「剪贴板历史.app」拖动到「应用程序」文件夹
3. 从启动台或应用程序文件夹打开应用
4. 首次运行时，右键点击应用选择「打开」

### 方法二：从源码构建

```bash
# 克隆或下载项目
cd /path/to/project

# 赋予脚本执行权限
chmod +x build.sh

# 运行构建脚本
./build.sh

# 构建完成后，应用位于 build/剪贴板历史.app
```

### 授予辅助功能权限（必需）

应用需要辅助功能权限来监听全局快捷键和模拟粘贴操作：

1. 打开「系统设置」（System Settings）
2. 进入「隐私与安全性」（Privacy & Security）
3. 点击「辅助功能」（Accessibility）
4. 点击左下角的锁图标解锁
5. 点击「+」按钮，添加「剪贴板历史.app」
6. 确保应用旁边的复选框已勾选

## 使用方法

### 基本操作

1. **启动应用**: 打开应用后，会在状态栏（菜单栏右侧）显示剪贴板图标
2. **复制内容**: 正常使用 `⌘C` 复制内容，应用会自动记录
3. **打开历史**: 按 `⌘⌥V` 快捷键在屏幕底部打开历史窗口
4. **搜索**: 在搜索框中输入关键词过滤历史记录
5. **选择粘贴**: 
   - 使用 `←` `→` 方向键左右选择项目（横向滚动）
   - 按 `回车` 或 `双击` 项目即可粘贴
   - 按 `ESC` 关闭窗口

### 快捷键列表

| 快捷键 | 功能 |
|--------|------|
| `⌘⌥V` | 显示/隐藏剪贴板历史窗口（屏幕底部） |
| `←` `→` | 在历史列表中左右选择（横向滚动） |
| `回车` | 粘贴选中的项目 |
| `ESC` | 关闭历史窗口 |
| `Delete` | 删除选中的历史项 |

### 状态栏菜单

点击状态栏图标可以访问：
- 显示历史窗口
- 清空所有历史记录
- 查看应用信息
- 退出应用

## 项目结构

```
mac剪贴板/
├── ClipboardHistory/
│   ├── Sources/
│   │   ├── main.swift                    # 应用入口
│   │   ├── AppDelegate.swift             # 应用代理
│   │   ├── ClipboardItem.swift           # 数据模型
│   │   ├── ClipboardManager.swift        # 剪贴板管理
│   │   ├── KeyboardShortcutManager.swift # 快捷键管理
│   │   └── HistoryWindowController.swift # 历史窗口
│   └── Info.plist                        # 应用配置
├── build.sh                              # 构建脚本
├── package.sh                            # 打包脚本
└── README.md                             # 说明文档
```

## 技术实现

### 核心技术

- **语言**: Swift 5.0+
- **框架**: 
  - Cocoa (AppKit) - 用户界面
  - Carbon - 全局快捷键监听
  - NSPasteboard - 剪贴板监听
  - UserDefaults - 数据持久化

### 主要功能实现

1. **剪贴板监听**: 使用定时器轮询 `NSPasteboard` 的 `changeCount`
2. **快捷键**: 通过 Carbon Events API 注册全局热键
3. **自动粘贴**: 使用 `CGEvent` 模拟 `⌘V` 键盘事件
4. **数据存储**: JSON 序列化保存到 UserDefaults
5. **多类型支持**: 根据 pasteboard types 识别不同数据类型

## 打包分发

### 创建 DMG 安装包

```bash
# 首先构建应用
./build.sh

# 然后打包成 DMG
chmod +x package.sh
./package.sh

# 生成的 DMG 文件位于 build/剪贴板历史-1.0.0.dmg
```

### 代码签名（可选）

如果要分发给其他用户，建议进行代码签名：

```bash
# 使用开发者证书签名
codesign --force --deep --sign "Developer ID Application: Your Name" \
    build/剪贴板历史.app

# 验证签名
codesign --verify --verbose build/剪贴板历史.app
```

## 常见问题

### 1. 快捷键不工作

**解决方法**: 确保已授予辅助功能权限（见安装说明）

### 2. 应用无法打开

**原因**: macOS Gatekeeper 安全限制

**解决方法**: 
- 右键点击应用，选择「打开」
- 或在「系统设置」>「隐私与安全性」中允许运行

### 3. 粘贴功能不工作

**原因**: 缺少辅助功能权限或目标应用不支持

**解决方法**:
- 确认已授予辅助功能权限
- 尝试在不同的应用中测试

### 4. 历史记录没有保存

**原因**: 应用被强制退出

**解决方法**: 正常退出应用（从菜单选择「退出」）

## 开发计划

未来可能添加的功能：

- [ ] 支持富文本格式
- [ ] 云端同步（iCloud）
- [ ] 自定义快捷键
- [ ] 历史记录分类和标签
- [ ] 常用项目固定功能
- [ ] 更多的数据类型支持
- [ ] 历史记录加密
- [ ] 深色/浅色主题切换

## 许可证

本项目仅供学习和个人使用。

## 反馈与贡献

如有问题或建议，欢迎反馈！

---

**注意**: 本应用仅支持 macOS 系统，不支持 Windows 或 Linux。
